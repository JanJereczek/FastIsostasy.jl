<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Examples · FastIsostasy.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="https://fonts.googleapis.com/css?family=Montserrat|Source+Code+Pro&amp;display=swap" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FastIsostasy.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li class="is-active"><a class="tocitem" href>Examples</a><ul class="internal"><li><a class="tocitem" href="#Multi-layer-Earth"><span>Multi-layer Earth</span></a></li><li><a class="tocitem" href="#Simple-load-and-geometry"><span>Simple load and geometry</span></a></li><li><a class="tocitem" href="#Simple-load-and-geometry-DIY"><span>Simple load and geometry - DIY</span></a></li><li><a class="tocitem" href="#GIA-following-Antarctic-deglaciation"><span>GIA following Antarctic deglaciation</span></a></li><li><a class="tocitem" href="#Inversion-of-solid-Earth-parameters"><span>Inversion of solid-Earth parameters</span></a></li></ul></li><li><a class="tocitem" href="../APIref/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Examples</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Examples</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JanJereczek/FastIsostasy.jl/blob/main/docs/src/examples.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h1><h2 id="Multi-layer-Earth"><a class="docs-heading-anchor" href="#Multi-layer-Earth">Multi-layer Earth</a><a id="Multi-layer-Earth-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-layer-Earth" title="Permalink"></a></h2><p>FastIsostasy relies on a (polar) stereographic projection that allows to treat the radially-layered, onion-like structure of the solid Earth as a superposition of horizontal layers. Furthermore, FastIsostasy reduces this 3D problem into a 2D problem by collapsing the depth dimension by computing an effective viscosity field. The user is required to provide the 3D information, which will then be used under the hood to compute the effective viscosity. This tutorial shows such an example.</p><p>We want to render a situation similar to the one depicted below:</p><p><img src="../assets/sketch_3layer_model_dark.png" alt="Schematic representation of the three-layer set-up."/></p><p>Initializing a <a href="../APIref/#FastIsostasy.MultilayerEarth"><code>MultilayerEarth</code></a> with parameters corresponding to this situation automatically computes the conversion from a 3D to a 2D problem. This can be simply executed by running:</p><pre><code class="language-julia hljs">W = 3000e3      # (m) half-width of the domain
n = 8           # implies an NxN grid with N = 2^n = 256.
Omega = ComputationDomain(W, n)
c = PhysicalConstants()

lv = [1e19, 1e21]       # (Pa*s)
lb = [88e3, 400e3]      # (m)
p = MultilayerEarth(Omega, c, layer_viscosities = lv, layer_boundaries = lb)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><p>The next section shows how to use the now obtained <code>p::MultilayerEarth</code> for actual GIA computation.</p><h2 id="Simple-load-and-geometry"><a class="docs-heading-anchor" href="#Simple-load-and-geometry">Simple load and geometry</a><a id="Simple-load-and-geometry-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-load-and-geometry" title="Permalink"></a></h2><p>We now apply a constant load, here a cylinder of ice with radius <span>$R = 1000 km$</span> and thickness <span>$H = 1 km$</span>, over the domain introduced in <a href="#Multi-layer-Earth">Multi-layer Earth</a>. To obtain the bedrock displacement over time and store it at time steps specified by a vector <code>t_out</code>, we can use the convenience function <a href="../APIref/#FastIsostasy.fastisostasy"><code>fastisostasy</code></a>:</p><pre><code class="language-julia hljs">R = 1000e3                  # ice disc radius (m)
H = 1000.0                  # ice disc thickness (m)
Hice = uniform_ice_cylinder(Omega, R, H)
t_out = years2seconds.([0.0, 100.0, 500.0, 1500.0, 5000.0, 10_000.0, 50_000.0])

results = fastisostasy(t_out, Omega, c, p, Hice)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><p>Yes, that was it! You can now easily access the elastic and viscous displacement by calling <code>results.elastic</code> or <code>results.viscous</code>. For the present case, the latter can be compared to an analytic solution that is known for this particular case. Let&#39;s look at the accuracy of our numerical scheme over time by running following plotting commands:</p><pre><code class="language-julia hljs">M = Omega.N ÷ 2
x = diag(Omega.X)[1:M]
y = diag(Omega.Y)[1:M]
r = sqrt.( x .^ 2 + y .^ 2 )

fig = Figure()
ax3 = Axis(fig[1, 1])
colors = [:gray80, :gray65, :gray50, :gray35, :gray20, :gray5]

for i in eachindex(t_out)
    t = t_out[i]
    analytic_solution_r(r) = analytic_solution(r, t, c, p, H, R, analytic_support)
    u_analytic = analytic_solution_r.( r )
    u_numeric = diag(results.viscous[i])
    lines!(ax3, x, u_numeric[1:M], color = colors[i], linewidth = 5)
    lines!(ax3, x, u_analytic, color = colors[i], linewidth = 5, linestyle = :dash)
end
fig</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h3 id="Time-changing-load"><a class="docs-heading-anchor" href="#Time-changing-load">Time-changing load</a><a id="Time-changing-load-1"></a><a class="docs-heading-anchor-permalink" href="#Time-changing-load" title="Permalink"></a></h3><p>That looks pretty good! One might however object that the convenience function <a href="../APIref/#FastIsostasy.fastisostasy"><code>fastisostasy</code></a> ends up being not so convenient as soon as the ice load changes over time. This case can however be easily handled by providing snapshots of the ice thickness and their assoicated time. By passing this to <a href="../APIref/#FastIsostasy.fastisostasy"><code>fastisostasy</code></a>, an interpolator is created and called within the time integration. Let&#39;s create a tool example where the thickness of the ice cylinder asymptotically grows from 0 to 1 km, this can be implemented by:</p><pre><code class="language-julia hljs">normalized_asymptote(t) = 1 - exp(-t)
t_Hice_asymptotic = 0:10.0:t_out[end]
Hice_asymptotic = [normalized_asymptote(t) .* Hice for t in t_Hice_asymptote]
results = fastisostasy(t_out, Omega, c, p, t_Hice_asymptotic, Hice_asymptotic)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><p>This concept will also apply to the upper-mantle viscosity in future versions, as it can change over time.</p><h3 id="GPU-support"><a class="docs-heading-anchor" href="#GPU-support">GPU support</a><a id="GPU-support-1"></a><a class="docs-heading-anchor-permalink" href="#GPU-support" title="Permalink"></a></h3><p>For about <span>$n &gt; 6$</span>, the previous example can be computed even faster by using GPU parallelism. It could not represent less work from the user&#39;s perspective, as it boils down to calling the <code>ComputationDomain</code> with an extra keyword argument:</p><pre><code class="language-julia hljs">Omega = ComputationDomain(W, n, use_cuda=true)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><p>That&#39;s it, nothing more! One could suggest you lay back but your computation might be completed too soon for that.</p><div class="admonition is-info"><header class="admonition-header">Only CUDA supported!</header><div class="admonition-body"><p>For now only Nvidia GPUs are supported (sorry Mac users, destiny is taking its revenge upon you for being so cool) and there is no plan of extending this compatibility at this point.</p></div></div><h2 id="Simple-load-and-geometry-DIY"><a class="docs-heading-anchor" href="#Simple-load-and-geometry-DIY">Simple load and geometry - DIY</a><a id="Simple-load-and-geometry-DIY-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-load-and-geometry-DIY" title="Permalink"></a></h2><p>Nonetheless, as any high-level convenience function, <a href="../APIref/#FastIsostasy.fastisostasy"><code>fastisostasy</code></a> has limitations. An ice-sheet modeller typically wants to embed FastIsostasy within a time-stepping loop. This can be easily done by getting familiar with some intermediate-level functions:</p><pre><code class="language-julia hljs">W = 3000e3      # (m) half-width of the domain
n = 8           # implies an NxN grid with N = 2^n = 256.
Omega = ComputationDomain(W, n)
c = PhysicalConstants()
p = MultilayerEarth(Omega, c)

R = 1000e3                  # ice disc radius (m)
H = 1000.0                  # ice disc thickness (m)
Hice = uniform_ice_cylinder(Omega, R, H)
t_out = years2seconds.([0.0, 100.0, 500.0, 1500.0, 5000.0, 10_000.0, 50_000.0])

results = fastisostasy(t_out, Omega, c, p, Hice)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h2 id="GIA-following-Antarctic-deglaciation"><a class="docs-heading-anchor" href="#GIA-following-Antarctic-deglaciation">GIA following Antarctic deglaciation</a><a id="GIA-following-Antarctic-deglaciation-1"></a><a class="docs-heading-anchor-permalink" href="#GIA-following-Antarctic-deglaciation" title="Permalink"></a></h2><p>We now want to provide a tough example that presents:</p><ul><li>a heterogeneous lithosphere thickness</li><li>a heterogeneous upper-mantle viscosity</li><li>various viscous channels</li><li>a more elaborate load that evolves over time</li><li>changes in the sea-level</li></ul><p>For this we run a deglaciation of Antarctica, based on the ice thickness estimated in <a href=".">GLAC1D</a>.</p><pre><code class="language-julia hljs">W = 3000e3      # (m) half-width of the domain
n = 8           # implies an NxN grid with N = 2^n = 256.
Omega = ComputationDomain(W, n)
c = PhysicalConstants()</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre><h2 id="Inversion-of-solid-Earth-parameters"><a class="docs-heading-anchor" href="#Inversion-of-solid-Earth-parameters">Inversion of solid-Earth parameters</a><a id="Inversion-of-solid-Earth-parameters-1"></a><a class="docs-heading-anchor-permalink" href="#Inversion-of-solid-Earth-parameters" title="Permalink"></a></h2><p>FastIsostasy.jl relies on simplification of the full problem and might therefore need a calibration step to match the output of a 3D GIA model. By means of an unscented Kalman inversion, one can e.g. infer the appropriate effective upper-mantle viscosity based on the response of a 3D GIA model to a given load. Whereas this is know to be a tedious step, FastIsostasy is developped to ease the procedure by providing a convenience struct <code>Paraminversion</code> that can be run by:</p><pre><code class="language-julia hljs">W = T(3000e3)               # half-length of the square domain (m)
Omega = ComputationDomain(W, n)
c = PhysicalConstants()

lb = [88e3, 180e3, 280e3, 400e3]
lv = get_wiens_layervisc(Omega)
p = MultilayerEarth(
    Omega,
    c,
    layer_boundaries = lb,
    layer_viscosities = lv,
)
ground_truth = copy(p.effective_viscosity)

R = T(2000e3)               # ice disc radius (m)
H = T(1000)                 # ice disc thickness (m)
Hcylinder = uniform_ice_cylinder(Omega, R, H)
t_out = years2seconds.(0.0:1_000.0:2_000.0)

t1 = time()
results = fastisostasy(t_out, Omega, c, p, Hcylinder, ODEsolver=BS3(), interactive_geostate=false)
t_fastiso = time() - t1
println(&quot;Took $t_fastiso seconds!&quot;)
println(&quot;-------------------------------------&quot;)

tinv = t_out[2:end]
Hice = [Hcylinder for t in tinv]
Y = results.viscous[2:end]
paraminv = ParamInversion(Omega, c, p, tinv, Y, Hice)
priors, ukiobj = perform(paraminv)
logeta, Gx, e_mean, e_sort = extract_inversion(priors, ukiobj, paraminv)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&lt;&lt; @example-block not executed in draft mode &gt;&gt;</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Introduction</a><a class="docs-footer-nextpage" href="../APIref/">API reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Monday 24 July 2023 16:34">Monday 24 July 2023</span>. Using Julia version 1.9.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
